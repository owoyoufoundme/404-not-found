<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gacha Room</title>
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  font-family: "Patrick Hand", cursive;
  background: linear-gradient(#ffe6f0, #fff);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.card {
  width: 400px;
  background: white;
  border-radius: 20px;
  padding: 30px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}
input, button {
  font-family: inherit;
  padding: 10px;
  margin-top: 10px;
  border-radius: 10px;
}
input { width: 80%; border: 2px solid #ff9ecb; }
button { border: none; background: #ff9ecb; cursor: pointer; }
button:hover { background: #ff7fb5; }
.gacha-image { width: 100%; max-height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 15px; }
.hidden { display: none; }
#coinsDisplay { font-size: 18px; margin-bottom: 10px; }
</style>
</head>
<body>

<div class="card">
  <!-- CUTSCENE VIDEO -->
  <div id="cutscene" class="hidden" style="
    position: fixed; inset:0;
    background:black;
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:10000;
  ">
    <video id="cutsceneVideo" width="80%" height="80%">
      <source src="blue.mp4" type="video/mp4">
      Your browser does not support video.
    </video>
  </div>
  
  <!-- REWARD POPUP -->
  <!-- REWARD POPUP -->
<div id="rewardPopup" class="hidden" style="
  position: fixed; inset:0;
  background: rgba(255,255,255,0.95);
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction: column;
  z-index:10001;
  text-align:center;
  font-family: 'Patrick Hand', cursive;
">
  <h2 id="rewardTitle" style="font-size:36px; margin-bottom:10px;"></h2>
  <img id="rewardImage" src="" style="
    max-width:80%;
    max-height:80%;
    border-radius:12px;
    object-fit:contain;
  ">
  <p style="margin-top:10px; font-size:18px;">Click anywhere to continue</p>
</div>

  <!-- NAME SETUP -->
  <div id="nameSetup">
    <h1>Welcome â™¡</h1>
    <p>Enter your name:</p>
    <input id="playerNameInput" placeholder="Your name">
    <br>
    <button onclick="registerName()">Enter</button>
  </div>

  <!-- GACHA UI -->
  <div id="gachaUI" class="hidden">
    <div id="coinsDisplay">ðŸª™ 0</div>
    <img src="www.png" alt="Gacha Banner" class="gacha-image">
    <button onclick="rollGacha()">Pull Gacha</button>
    <div id="history"></div>
  </div>

</div>

<script>



const GACHA_COST = 10;
let player = { name: "", coins: 0, history: [], usedCodes: [] };

// --- LOAD PLAYER ---
function loadPlayer() {
  const savedName = localStorage.getItem("currentPlayerName");
  const allPlayers = JSON.parse(localStorage.getItem("gachaPlayers") || "[]");
  if(savedName) {
    const savedPlayer = allPlayers.find(p=>p.name===savedName);
    if(savedPlayer) {
      player = savedPlayer;
      showGacha();
      return;
    }
  }
  document.getElementById("nameSetup").classList.remove("hidden");
}

// --- SAVE PLAYER ---
function savePlayer() {
  let allPlayers = JSON.parse(localStorage.getItem("gachaPlayers") || "[]");
  const idx = allPlayers.findIndex(p=>p.name===player.name);
  if(idx>-1) allPlayers[idx]=player;
  else allPlayers.push(player);
  localStorage.setItem("gachaPlayers", JSON.stringify(allPlayers));
  localStorage.setItem("currentPlayerName", player.name);
  updateUI();
}

// --- REGISTER NAME ---
function registerName() {
  const name = document.getElementById("playerNameInput").value.trim();
  if(!name) return alert("Enter a valid name!");
  const allPlayers = JSON.parse(localStorage.getItem("gachaPlayers") || "[]");
  const existing = allPlayers.find(p=>p.name===name);
  if(existing) player = existing;
  else player = { name, coins: 50, history: [], usedCodes: [] };
  savePlayer();
  showGacha();
}

// --- SHOW GACHA ---
function showGacha() {
  document.getElementById("nameSetup").classList.add("hidden");
  document.getElementById("gachaUI").classList.remove("hidden");
  updateUI();
}

// --- UPDATE UI ---
function updateUI() {
  document.getElementById("coinsDisplay").innerText = `ðŸª™ ${player.coins}`;
  document.getElementById("history").innerHTML = player.history.map(h=>`â€¢ ${h}`).join("<br>");
}

// --- GACHA ROLL ---
// Gacha pool with rarities
const pool = [
  { name: "Health Potion", url: "file.png", rarity: "common", weight: 60 },
  //{ name: "Speed Potion", url: "speed.png", rarity: "common", weight: 60 },
  //{ name: "Golden Ticket", url: "golden.png", rarity: "rare", weight: 25 },
  //{ name: "Magic Elixir", url: "elixir.png", rarity: "legendary", weight: 10 },
  //{ name: "Corrupted Core", url: "corrupted.png", rarity: "secret", weight: 5 }
];
  

function getWeightedRandom(pool) {
  const totalWeight = pool.reduce((sum, item) => sum + item.weight, 0);
  let rand = Math.random() * totalWeight;

  for (let item of pool) {
    if (rand < item.weight) return item;
    rand -= item.weight;
  }
}
function rollGacha() {
  if(player.coins < GACHA_COST) return alert("Not enough coins!");
  player.coins -= GACHA_COST;
 
  updateUI();

  const reward = getWeightedRandom(pool);

  // Show cutscene
  const cutscene = document.getElementById("cutscene");
  const video = document.getElementById("cutsceneVideo");

  cutscene.classList.remove("hidden");
  video.currentTime = 0;
  video.play();

  // Hide reward until cutscene finishes
  const popup = document.getElementById("rewardPopup");
  popup.classList.add("hidden");

  video.onended = () => {
    cutscene.style.transition = "background 0.5s";
    cutscene.style.background = "white";

    setTimeout(() => {
      cutscene.classList.add("hidden");
      showReward(reward); // show reward after fade
    }, 500);
  };
}



function showReward(reward) {
  const popup = document.getElementById("rewardPopup");
  const title = document.getElementById("rewardTitle");
  const img = document.getElementById("rewardImage");

  title.innerText = `${reward.name} (${reward.rarity.toUpperCase()})`;
  img.src = reward.url;

  popup.classList.remove("hidden");

  // Add reward to history
  player.history.unshift(`${reward.name} [${reward.rarity}]`);
  savePlayer();

  // Click anywhere to close
  popup.onclick = () => popup.classList.add("hidden");
}




loadPlayer();
</script>

</body>
</html>
